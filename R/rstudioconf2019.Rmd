---
title: "Takeaways from rstudio::conf2019"
output: github_document
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
library(tidyr)
knitr::opts_chunk$set(echo = TRUE)
```

*From the webinars, because I did not attend* :sob:

## R Markdown

### Advanced R Markdown Workshop, Yihui Xie and Alison Hill

[Website](https://arm.rbind.io/)
[Video](https://youtu.be/6JX4UNxEOLU)

#### Part I: Customizing R Markdown

#### Part II: R Markdown extensions

## Tidy eval

### Tidy eval in context, Jenny Brian

[Repo](https://github.com/jennybc/tidy-eval-context#readme), [Video](https://resources.rstudio.com/rstudio-conf-2019/lazy-evaluation)

You may **not** need tidy eval. Most people don't need to make direct use of [rlang](https://rlang.r-lib.org/).

| You want to ... | You need to know this much tidy eval |
|-----------------|--------------------------------------|
| Write simple functions to reduce duplication    | Pass the dots, `enquo()`, `!!` |
| Write functions that make names from user input | `:=` |
| Compute on expressions and manipulate environments | Know the theory + rlang | 

### Working with names and expressions in your tidy eval code, Lionel Henry

[Slides](https://speakerdeck.com/lionelhenry/selecting-and-doing-with-tidy-eval), [Video](https://resources.rstudio.com/rstudio-conf-2019/working-with-names-and-expressions-in-your-tidy-eval-code)

#### Context

There are two dplyr flavours:

- Action verbs: `mutate()`, `transmute()`, `summarise()`, `group_by()`
- Selection verbs: `select()`

Use scoped dplyr verbs (e.g. `group_by_at()`) to pass selections to action verbs.

#### "Passing the dots" strategies

1. Selections with dplyr
  
    ```{r}
    summary_functions <- list(
      ~ mean(., na.rm = TRUE),
      ~ sd(., na.rm = TRUE)
    )
    
    # Pass the dots!
    summarise_sels <- function(.data, ...) {
      summarise_at(.data, vars(...), summary_functions)
    }
    
    
    starwars %>% 
      summarise_sels(height:mass)
    ```

1. Actions with dplyr

    ```{r}
    # Pass the dots! 
    summarise_act <- function(.data, ...) {
      .data %>% 
        transmute(...) %>% 
        summarise_all(summary_functions)
    }
    
    starwars %>% 
      summarise_act(
        heightm = height / 100,
        bmi = mass / heightm^2 
      )
    ```

1. Gather with tidyr

    ```{r}
    gather_summarise_act <- function(.data, ...) {
      .data %>% 
        transmute(...) %>% 
        gather("Variable", "Value", -one_of(group_vars(.))) %>% 
        summarise_at(vars(Value), summary_functions)
    }
    
    starwars %>% 
      group_by(gender) %>% 
      gather_summarise_act(
        heightm = height / 100,
        bmi = mass / heightm^2 
      )
    ```
    
    
#### Takeaways

- "Passing the dots" strategies with dplyr (selection _and_ actions) work easily with gouped data.

- For other functions, like `tidyr::gather()`, we need to deal with the grouping variables inside the function.

- New discovery: [`dplyr::group_vars()`](https://dplyr.tidyverse.org/reference/groups.html)

